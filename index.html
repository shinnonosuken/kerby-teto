<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Star Drop Blocks - Cute BGM & Effects</title>
<style>
  :root{
    --bg:#fde6f2; --panel:#ffffffdd; --ink:#4b2b3f; --accent:#ff77b7; --accent2:#8ae1ff;
  }
  html,body{margin:0;height:100%;background:
    radial-gradient(circle at 20% 15%, #fff6, transparent 40%),
    radial-gradient(circle at 80% 70%, #fff6, transparent 35%), var(--bg);
    color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
    touch-action:none;
  }
  .wrap{display:flex;flex-direction:column;align-items:center;gap:10px;padding:10px 8px 90px;min-height:100%;}
  h1{font-size:1.1rem;margin:10px 0 0;}
  .hud{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:center;background:var(--panel);
    border-radius:16px;padding:6px 10px;box-shadow:0 6px 16px #00000014;}
  .badge{padding:4px 8px;border-radius:999px;background:#fff;box-shadow:inset 0 1px 0 #ffffffcc;}
  .board-wrap{position:relative;display:flex;gap:10px;align-items:flex-start;justify-content:center}
  canvas{background:
    radial-gradient(circle at 10% 20%, #fff8 0 2px, transparent 3px),
    radial-gradient(circle at 70% 30%, #fff8 0 2px, transparent 3px),
    radial-gradient(circle at 30% 80%, #fff8 0 2px, transparent 3px), #fefbff;
    border-radius:14px;box-shadow:0 10px 24px #0000001a,inset 0 2px 0 #ffffffcc;image-rendering:pixelated;}
  .side{background:var(--panel);border-radius:16px;padding:8px;width:120px;box-shadow:0 6px 16px #00000014;}
  .side h3{font-size:.9rem;margin:.2rem 0 .4rem;}
  .mini{width:100%;aspect-ratio:1/1;background:#fff;border-radius:10px;box-shadow:inset 0 2px 0 #ffffffcc;}
  .pad{position:fixed;left:0;right:0;bottom:0;backdrop-filter:blur(6px);
    background:linear-gradient(180deg,#ffffffaa,#ffffffee);padding:8px;display:grid;gap:8px;grid-template-columns:repeat(6,1fr);
    box-shadow:0 -6px 16px #0000001a;z-index:10;}
  .btn{-webkit-tap-highlight-color:transparent;user-select:none;touch-action:manipulation;text-align:center;font-weight:700;
    padding:10px 8px;border-radius:12px;border:0;background:#fff;box-shadow:0 6px 12px #00000014,inset 0 2px 0 #ffffffcc;}
  .btn:active{transform:translateY(1px)}
  .btn.accent{background:linear-gradient(180deg,#fff,#ffe7f3);color:#b30066;}
  .btn.accent2{background:linear-gradient(180deg,#fff,#e6f9ff);color:#005b77;}
  .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#00000033;border-radius:14px;color:#fff;text-align:center;padding:20px;}
  .card{background:#ffffffee;color:var(--ink);border-radius:16px;padding:16px;max-width:420px;box-shadow:0 10px 24px #00000026;}
  .card h2{margin:.2rem 0 .6rem;}
  .muted{opacity:.7;font-size:.9rem;}
  .flash{pointer-events:none;position:absolute;inset:0;border-radius:14px;background:radial-gradient(circle,#fff8,#fff0 60%);opacity:0;transition:opacity .18s;}
  .shake{animation:shake .18s linear 1;}
  @keyframes shake{
    0%{transform:translate(0,0)}25%{transform:translate(2px,-2px)}
    50%{transform:translate(-2px,2px)}75%{transform:translate(2px,2px)}100%{transform:translate(0,0)}
  }
  @media (min-width:800px){.wrap{padding-bottom:30px}.pad{display:none}}
</style>
</head>
<body>
<div class="wrap">
  <h1>🌟 Star Drop Blocks</h1>
  <div class="hud" aria-live="polite">
    <div class="badge" id="stage">Stage 1</div>
    <div class="badge" id="target">Target: 10 lines</div>
    <div class="badge" id="lines">Lines: 0</div>
    <div class="badge" id="score">Score: 0</div>
    <div class="badge" id="status">Ready</div>
  </div>

  <div class="board-wrap">
    <div style="position:relative">
      <canvas id="game" width="300" height="600" aria-label="Game board" role="img"></canvas>
      <div id="flash" class="flash"></div>
    </div>
    <div class="side">
      <h3>Next</h3>
      <canvas id="next" class="mini" width="120" height="120"></canvas>
      <h3>Hold</h3>
      <canvas id="hold" class="mini" width="120" height="120"></canvas>
      <button id="btnStart" class="btn accent" style="width:100%;margin-top:8px;">▶︎ Start</button>
      <button id="btnPause" class="btn" style="width:100%;margin-top:6px;">⏸ Pause</button>
      <button id="btnRestart" class="btn" style="width:100%;margin-top:6px;">↻ Restart</button>
      <button id="btnMute" class="btn" style="width:100%;margin-top:6px;">🔊 Sound</button>
      <p class="muted" style="margin:.6rem 0 0;">PC: ←→/↑(Z,X)/↓/Space/P/R・スマホは下のパッド</p>
    </div>

    <div id="overlay" class="overlay" style="display:flex;">
      <div class="card">
        <h2>10ライン消したらクリア！</h2>
        <p>StartでBGMが鳴ります（いつでも🔊でミュート可）。</p>
        <ul style="margin:.5rem 0 .2rem;">
          <li>PC：← → / ↑ Z X / ↓ / Space / P</li>
          <li>スマホ：画面下のボタンで操作</li>
        </ul>
        <p class="muted">ブロックをそろえて横一列を消そう！</p>
        <button class="btn accent" id="overlayStart">▶︎ Start</button>
      </div>
    </div>
  </div>
</div>

<!-- モバイル操作 -->
<div class="pad" id="pad">
  <button class="btn" data-action="left" aria-label="Left">◀︎</button>
  <button class="btn" data-action="right" aria-label="Right">▶︎</button>
  <button class="btn accent2" data-action="rotL" aria-label="Rotate Left">⟲</button>
  <button class="btn accent2" data-action="rotR" aria-label="Rotate Right">⟳</button>
  <button class="btn" data-action="soft" aria-label="Soft Drop">↓</button>
  <button class="btn accent" data-action="hard" aria-labe
